```sql
CREATE OR REPLACE PACKAGE P_INIT_ZUZHIGANGWEI_SCRIPT IS
 procedure P_INIT_IN_ZUZHIGANGWEI_SCRIPT;

 procedure PRO_insert_canvas;
 --add v2.1_539 20161018 xlh begin
 procedure PRO_org_home_change_level;
 --add v2.1_539 20161018 xlh end
END P_INIT_ZUZHIGANGWEI_SCRIPT;



--aiiw--CREATE OR REPLACE PACKAGE P_INIT_ZUZHIGANGWEI_SCRIPT IS
 procedure P_INIT_IN_ZUZHIGANGWEI_SCRIPT;

 procedure PRO_insert_canvas;
 --add v2.1_539 20161018 xlh begin
 procedure PRO_org_home_change_level;
 --add v2.1_539 20161018 xlh end
END P_INIT_ZUZHIGANGWEI_SCRIPT;

CREATE OR REPLACE PACKAGE BODY P_INIT_ZUZHIGANGWEI_SCRIPT IS
  -----------组织岗位那个长表
  /**
   @author xumingjian
   @date 2015-03-3
   @desc 组织岗位-->组织岗位那个长表
  */
  procedure PRO_ZUZHIGANGWEICOUNT as
   BEGIN
   delete from TB_TEMP_ORG2;
  insert into TB_TEMP_ORG2 value
  with org_unit as
  (select o1.c_hid,
          o1.c_name,
          o2.c_path_code,
          o2.c_superior_hid,
          o1.c_est_date,
          o1.c_type,
          o1.c_org_level,
          o1.C_ASSETLIGAMENT,
          o1.c_unitclass,
          o1.c_unitclass_detail,
          o1.C_COMPANY_TYPE,
          o1.C_storey,
          o1.C_TEAM_TYPE,
          o1.C_ORG_MAJOR_FIELD,
          o1.C_MGMT_SPEC
     from tb_org_orgunit o1, tb_org_unitrelation o2
    where o1.c_hid = o2.c_org_hid
      and o1.c_status = '1'
      and sysdate between o1.c_begin_date and o1.c_end_date
      and o2.c_status = '1'
      and sysdate between o2.c_begin_date and o2.c_end_date
      and o1.C_CHARACTER_DEP = '111'
      and o2.c_superior_hid <> o2.c_org_hid), temp_org as
  (select ou1.c_hid,
          ou1.c_name,
          ou1.c_path_code,
          ou1.c_superior_hid,
          ou1.c_est_date,
          ou1.c_type,
          ou1.c_org_level,
          ou1.C_ASSETLIGAMENT,
          ou1.c_unitclass,
          ou1.c_unitclass_detail,
          ou1.C_COMPANY_TYPE,
          ou1.C_storey,
          ou1.C_TEAM_TYPE,
           ou1.C_ORG_MAJOR_FIELD,
          ou1.C_MGMT_SPEC
     from org_unit ou1
    where ou1.c_path_code like
          (select ou2.c_path_code || '%'
             from org_unit ou2
            where ou2.c_hid = '7f304de353c358egcfg267f023db8f25')
      and ou1.C_EST_DATE <= SYSDATE
      AND ou1.c_type = '0'), temp_org1 as
  (select ou1.c_hid,
          ou1.c_name,
          ou1.c_path_code,
          ou1.c_superior_hid,
          ou1.c_est_date,
          ou1.c_type,
          ou1.c_org_level,
          ou1.C_ASSETLIGAMENT,
          ou1.c_unitclass,
          ou1.c_unitclass_detail,
          ou1.C_COMPANY_TYPE,
          ou1.C_storey,
          ou1.C_TEAM_TYPE,
           ou1.C_ORG_MAJOR_FIELD,
          ou1.C_MGMT_SPEC
     from org_unit ou1
    where ou1.c_path_code like
          (select ou2.c_path_code || '%'
             from org_unit ou2
            where ou2.c_hid = '7f304de353c358egcfg267f023db8f25')
      and ou1.C_EST_DATE <= SYSDATE
      AND ou1.c_type != '0'), temp_org2 as
  (select *
     from temp_org1 te
    where te.c_unitclass = '8'
      and te.c_path_code is not null)
  select * from temp_org2;

       DELETE FROM tb_org_count_homepage
     WHERE c_YEAR = to_number(TO_CHAR(SYSDATE, 'yyyy'))
       AND c_MONTH = to_number(TO_CHAR(SYSDATE, 'MM'));

   INSERT INTO tb_org_count_homepage
    (C_OID,
     C_OPERATOR,
     C_OPERATE_TIME,
     C_ORG_NAME,
     C_ORG_LEVEL,
     C_PARENT_NAME,
     C_NIUDAI_GUANXI,
     C_DEPT,
     C_JIGOU_COUNT,
     C_JIGOU_CHENGQU,
     C_JIGOU_XZ_GONGDIAN,
     C_GUAKAOJIKAO,
     C_DEP_JIGOU_COUNT,
     C_DEP_JIGOU_CHUSHI,
     C_DEP_JIGOU_FENBU,
     C_DEP_JIGOU_GDS,
     C_ZHIGUAN_COUNT,
     C_ZHIGUAN_DSJGD,
     C_ZHIGUAN_CGYJ,
     C_ZHIGUAN_FDC,
     C_ZHIGUAN_XJFGS,
     C_2ZHIGUAN_XJZGS,
     C_ZHIGUAN_DGXGS,
     C_ZHIGUAN_QITA,
     C_ZHIGUAN_ZCND,
     C_ZHIGUAN_QZZGS,
     C_ZHIGUAN_KGZGS,
     C_ZHIGUAN_QITA2,
     C_NEISHE_COUNT,
     C_NEISHE_FADIAN,
     C_NEISHE_SHUDIAN,
     C_NEISHE_BIANDIAN,
     C_NEISHE_PEIDIAN,
     C_NEISHE_YINGXIAO,
     C_NEISHE_DIAODU,
     C_NEISHE_TONGXIN,
     C_NEISHE_XINXI,
     C_NEISHE_WULIU,
     C_NEISHE_FUZHU,
     C_NEISHE_QITA,
     C_YEAR,
     C_MONTH,
     C_ORGID,
     C_LEVEL,
     c_path_code,
     C_NUMBER)
 SELECT SYS_GUID(),
         'TB',
         SYSDATE,
         ORG_NAME,
         ORG_LEVELNAME,
         ORG_PARENTNAME,
         ORG_ASSETLIGAMENT,
         nvl(ORG_ZHINENGCOUNT,0),
         nvl(ORG_ZHISHUCOUNT,0),
         nvl(ORG_chengqucout,0),
         nvl(ORG_xiangzhencount,0),
         nvl(ORG_GUAKAOCOUNT,0),
         nvl(ORG_JSXIAOJI,0),
         nvl(ORG_neishechushicount,0),
         nvl(ORG_neishekeshicount,0),
         nvl(ORG_xiangzhencount1,0),
         nvl(ORG_zhiguancount,0),
         nvl(ORG_zgchenggongcount,0),
         nvl(ORG_zgchaogaocount,0),
         nvl(fadian,0),
         nvl(ORG_zgxianjifencount,0),
         nvl(ORG_zgxianjizicount,0),
         nvl(ORG_zgdaiguancount,0),
         nvl(ORG_zhiguancount,0)-(nvl(ORG_zgxianjifencount,0)+nvl(ORG_zgdaiguancount,0)+nvl(ORG_zgxianjizicount,0)+nvl(ORG_zgchaogaocount,0)+nvl(fadian,0)+nvl(ORG_zgchenggongcount,0)),
         nvl(C_assetligament1,0),
         nvl(C_assetligament2,0),
         nvl(C_assetligament3,0),
         nvl(C_assetligament4,0),
         (nvl(generate,0)+nvl(tranelectron,0)+nvl(setelect,0)+nvl(changeelec,0)+nvl(adapter,0)+nvl(correspond,0)+nvl(info,0)+nvl(sales,0)+nvl(logistics,0)++nvl(assist,0)+nvl(other,0)) tinycount,
         nvl(generate,0),
         nvl(tranelectron,0),
          nvl(changeelec,0),
         nvl(setelect,0),
          nvl(sales,0),
         nvl(adapter,0),
         nvl(correspond,0),
         nvl(info,0),
         nvl(logistics,0),
         nvl(assist,0),
         nvl(other,0),
         to_number(to_char(sysdate, 'yyyy')),
         to_number(to_char(sysdate, 'mm')),
         c_hid,
         c_storey,
         c_path_code,
         '0'
    from (with org_unit as (
                  select o1.c_hid,
                         o1.c_name,
                         o2.c_path_code,
                         o2.c_superior_hid,
                         o1.c_est_date,
                         o1.c_type,
                         o1.c_org_level,
                         o1.C_ASSETLIGAMENT,
                         o1.c_unitclass,
                         o1.c_unitclass_detail,
                         o1.C_COMPANY_TYPE,
                         o1.C_storey,
                         o1.C_TEAM_TYPE
                    from tb_org_orgunit o1, tb_org_unitrelation o2
                   where o1.c_hid = o2.c_org_hid
                     and o1.c_status = '1'
                     and sysdate between o1.c_begin_date and o1.c_end_date
                     and o2.c_status = '1'
                     and sysdate between o2.c_begin_date and o2.c_end_date
                     and o1.C_CHARACTER_DEP = '111'
                     and o2.c_superior_hid <> o2.c_org_hid
           ),temp_org as (
                 select ou1.c_hid,
                        ou1.c_name,
                        ou1.c_path_code,
                        ou1.c_superior_hid,
                        ou1.c_est_date,
                        ou1.c_type,
                        ou1.c_org_level,
                        ou1.C_ASSETLIGAMENT,
                        ou1.c_unitclass,
                        ou1.c_unitclass_detail,
                        ou1.C_COMPANY_TYPE,
                        ou1.C_storey,
                        ou1.C_TEAM_TYPE
                   from org_unit ou1
                  where ou1.c_path_code like
                        (select ou2.c_path_code || '%'
                           from org_unit ou2
                          where ou2.c_hid =
                                '7f304de353c358egcfg267f023db8f25')
                    and ou1.C_EST_DATE <= SYSDATE
                    AND ou1.c_type = '0'
             ),temp_org1 as (
             select ou1.c_hid,
                    ou1.c_name,
                    ou1.c_path_code,
                    ou1.c_superior_hid,
                    ou1.c_est_date,
                    ou1.c_type,
                    ou1.c_org_level,
                    ou1.C_ASSETLIGAMENT,
                    ou1.c_unitclass,
                    ou1.c_unitclass_detail,
                    ou1.C_COMPANY_TYPE,
                    ou1.C_storey,
                    ou1.C_TEAM_TYPE
               from org_unit ou1
              where ou1.c_path_code like
                    (select ou2.c_path_code || '%'
                       from org_unit ou2
                      where ou2.c_hid = '7f304de353c358egcfg267f023db8f25')
                and ou1.C_EST_DATE <= SYSDATE
                AND ou1.c_type != '0')
                ,temp_org2 as (select * from tb_temp_org2 ou3)
           select  distinct t.c_hid,
                           t.C_storey,
                           t.c_path_code,
                           /*设立单位*/
                           t.c_name ORG_NAME,
                           /*显示该单位的所在单位层级*/
                           get_type_name('CODE_NW_10062', t.c_org_level) ORG_LEVELNAME,
                           /*显示该单位的上级单位*/
                           unitname(t.c_superior_hid) ORG_PARENTNAME,
                           /*显示该单位的资产纽带关系*/
                           get_type_name('CODE_NW_10004', t.C_ASSETLIGAMENT) ORG_ASSETLIGAMENT,
                           /*统计该单位下一级内设机构中机构类别=”部门“的总和*/
                           sum(decode(t1.c_unitclass, '2', 1, 0)) over(partition by t.c_hid) ORG_ZHINENGCOUNT,
                           /* 一级内设机构的机构类别为城区供电局+供电所+其他（直属）之和*/
                           sum(decode(t1.c_unitclass, '3', 1, 0)) over(partition by t.c_hid) ORG_ZHISHUCOUNT,
                           /*统计该单位一级内设机构中机构类别=”直属机构“且二级机构类别=”城区供电局“的总和*/
                           sum(decode(t1.c_unitclass,'3',decode(t1.c_unitclass_detail,'301',1,0),0)) over(partition by t.c_hid) ORG_chengqucout,
                           /*统计该单位一级内设机构中机构类别=”直属机构“且二级机构类别=”供电所“的总和 */
                           sum(decode(t1.c_unitclass,'3',decode(t1.c_unitclass_detail,'302',1,0),0)) over(partition by t.c_hid) ORG_xiangzhencount,
                           /*统计该单位一级内设机构中机构类别=”挂靠机构“*/
                           sum(decode(t1.c_unitclass, '4', 1, 0)) over(partition by t.c_hid) ORG_GUAKAOCOUNT,
                           /*二级内设机构机构类别为部门、直属机构（城区供电局、供电所）、处室、科室/分部、其他内设之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid) from org_unit te where te.c_superior_hid = t1.c_hid and te.c_unitclass in ('2', '3', '5', '6', '7', '99'))) over(partition by t.c_hid) ORG_JSXIAOJI,
                           /*统计单位二级内设机构中机构类别=”处室“的总和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid) from org_unit te where te.c_superior_hid = t1.c_hid and te.c_unitclass = '5')) over(partition by t.c_hid) ORG_neishechushicount,
                           /* 统计单位二级内设机构中机构类别=”科室/分部“的总和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid) from org_unit te where te.c_superior_hid = t1.c_hid and te.c_unitclass in ('6', '7'))) over(partition by t.c_hid) ORG_neishekeshicount,
                           /*统计该单位二级内设机构中机构类别=”直属机构“且二级机构类别=”供电所“的总和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from org_unit te
                                where te.c_superior_hid = t1.c_hid
                                  and te.c_unitclass = '3'
                                  and te.c_unitclass_detail = '302')) over(partition by t.c_hid) ORG_xiangzhencount1,
                           /*地市供电局+超高压局+发电厂+县级分公司+县级子公司+代管县公司+其他=按资产纽带关系统计之和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid) ORG_zhiguancount,
                           /* 统计单位下所设立的单位中，单位层级=“地市级单位”且单位类型=”供电企业“且单位名称中包含“供电局or供电有限公司or电力股份有限公司”的所有单位总和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_storey = '3'
                               and te.C_COMPANY_TYPE = '3'
                               and (te.c_name like '%供电局%' or
                                   te.c_name like '%供电有限公司%' or
                                   te.c_name like '%电力股份有限公司%')) ORG_zgchenggongcount,
                           /*单位层级=“地市级单位”且单位类型=”输电企业“且单位名称中包含“超高压”的所有单位总和；*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_storey = '3'
                               and te.C_COMPANY_TYPE = '2'
                               and (te.c_name like '%超高压%')) ORG_zgchaogaocount,
                           /* 统计单位下所设立的单位中，单位层级=“地市级单位”且单位类型=”发电企业“且单位名称中包含“发电or电厂”的所有单位总和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_storey = '3'
                               and te.C_COMPANY_TYPE = '1'
                               and (te.c_name like '%发电%' or
                                   te.c_name like '%电厂%')) fadian,
                           /*统计单位下所设立的单位中，单位层级=“县区级单位”且单位类型=”供电企业“且资产纽带关系=“分公司”且单位名称中包含“供电局or分局or文山电力”的所有单位总和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_storey = '4'
                               and te.C_COMPANY_TYPE = '3'
                               and te.C_ASSETLIGAMENT = '1'
                               and (te.c_name like '%供电局%' or
                                   te.c_name like '%分局%' or
                                   te.c_name like '%文山电力%')) ORG_zgxianjifencount,
                           /*单位层级=“县区级单位”且单位类型=”供电企业“且“资产纽带关系=“全资子公司or控股子公司”且单位名称中包含供电局or供电公司or电业公司or供电有限or电力公司“的所有单位总和 */
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_storey = '4'
                               and te.C_COMPANY_TYPE = '3'
                               and te.C_ASSETLIGAMENT = '2'
                               and (te.c_name like '%供电局%' or
                                   te.c_name like '%供电公司%' or
                                   te.c_name like '%供电有限%' or
                                   te.c_name like '%电业公司%' or
                                   te.c_name like '%电力公司%')) ORG_zgxianjizicount,
                           /*单位层级=“县区级单位”且单位类型=”代管县供电企业“的所有单位总和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_storey = '4'
                               and te.C_COMPANY_TYPE = '4') ORG_zgdaiguancount,
                           /*除了以上6种以外的单位总和*/
                           9999 ORG_zgqitacount,
                           /*统计单位下所设立的单位中，资产纽带关系=”分公司“的所有单位之和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_ASSETLIGAMENT = '1') C_assetligament1,
                           /*资产纽带关系=”全资子公司“的所有单位之和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_ASSETLIGAMENT = '2') C_assetligament2,
                           /*资产纽带关系=”控股子公司“的所有单位之和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_ASSETLIGAMENT = '3') C_assetligament3,
                           /*资产纽带关系=”其他“的所有单位之和*/
                           (select distinct sum(1) over(partition by t.c_hid)
                              from temp_org te
                             where te.c_superior_hid = t.c_hid
                               and te.C_ASSETLIGAMENT = '99') C_assetligament4,
                           /*小计等于所有之和*/
                           99999 tinycount,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”发电专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                 -- and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '1')) over(partition by t.c_hid) generate,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”输电专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                  --and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '2')) over(partition by t.c_hid) tranelectron,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”变电运行专业班组、变电检修专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                  --and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE in ('3','4'))) over(partition by t.c_hid) changeelec,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”配电专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                  --and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '8')) over(partition by t.c_hid) setelect,

                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”营销专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                 -- and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '9')) over(partition by t.c_hid) sales,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”调度专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                 -- and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '5')) over(partition by t.c_hid) adapter,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”通信专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                --  and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '6')) over(partition by t.c_hid) correspond,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”信息专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                --  and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '7')) over(partition by t.c_hid) info,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”物流专业班组“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                --  and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '10')) over(partition by t.c_hid) logistics,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”行政辅助班组、生产辅助班组、后勤班组、其他班组（辅助类）“之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                 -- and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE in
                                      ('13', '14', '15', '16'))) over(partition by t.c_hid) assist,
                           /*组织机构管理-机构维护-设立班组，统计该单位下，班组二级分类=”其他班组（技能类）”之和*/
                           sum((select distinct sum(1) over(partition by t1.c_hid)
                                 from temp_org2 te
                                where instr(te.c_path_code,t1.c_path_code)>0
                                 -- and te.c_unitclass = '8' and t1.c_path_code is not null
                                  and te.C_TEAM_TYPE = '12')) over(partition by t.c_hid) other
             from temp_org t
             left join org_unit t1 on t.c_hid = t1.c_superior_hid
                                  and t1.c_type <> '0') z;
                                  COMMIT;

  END PRO_ZUZHIGANGWEICOUNT;
/**
* 组织机构首页列表
* add v2.1_539 20161018 xlh
*/
procedure PRO_org_home_change_level as
   Cursor chang_level is
               select t.c_orgid,t.c_path_code from tb_org_count_homepage t
                 where t.c_year = to_char(sysdate,'yyyy') and t.c_month = to_char(sysdate,'mm');
                  orgid VARCHAR2(36);
                  path_code VARCHAR2(4000);
BEGIN
               open chang_level;
               loop
                fetch chang_level
                  into orgid,path_code;
                exit when chang_level%notfound;
                    INSERT INTO tb_org_count_homepage
                    SELECT
                       SYS_GUID(),
                       SYSDATE,
                       'TB',
                       '合计单位数(' || count(1) || ')',
                       t.c_org_level,
                       '--',
                       '--',
                       sum(t.c_dept),
                       sum(t.c_jigou_count),
                       sum(t.c_jigou_chengqu),
                       sum(t.c_jigou_xz_gongdian),
                       sum(t.c_guakaojikao),
                       sum(t.c_dep_jigou_count),
                       sum(t.C_DEP_JIGOU_CHUSHI),
                       sum(t.C_DEP_JIGOU_FENBU),
                       sum(t.C_DEP_JIGOU_GDS),
                       sum(t.C_ZHIGUAN_COUNT),
                       sum(t.C_ZHIGUAN_DSJGD),
                       sum(t.C_ZHIGUAN_CGYJ),
                       sum(t.C_ZHIGUAN_FDC),
                       sum(t.C_ZHIGUAN_XJFGS),
                       sum(t.C_2ZHIGUAN_XJZGS),
                       sum(t.C_ZHIGUAN_DGXGS),
                       sum(t.C_ZHIGUAN_QITA),
                       sum(t.C_ZHIGUAN_ZCND),
                       sum(t.C_ZHIGUAN_QZZGS),
                       sum(t.C_ZHIGUAN_KGZGS),
                       sum(t.C_ZHIGUAN_QITA2),
                       sum(t.C_NEISHE_COUNT),
                       sum(t.C_NEISHE_FADIAN),
                       sum(t.C_NEISHE_SHUDIAN),
                       sum(t.C_NEISHE_BIANDIAN),
                       sum(t.C_NEISHE_PEIDIAN),
                       sum(t.C_NEISHE_YINGXIAO),
                       sum(t.C_NEISHE_DIAODU),
                       sum(t.C_NEISHE_TONGXIN),
                       sum(t.C_NEISHE_XINXI),
                       sum(t.C_NEISHE_WULIU),
                       sum(t.C_NEISHE_FUZHU),
                       sum(t.C_NEISHE_QITA),
                       to_char(sysdate, 'yyyy'),
                       to_char(sysdate, 'mm'),
                       orgid,
                       t.c_level,
                       path_code,
                       '1'
                        from tb_org_count_homepage t
                        where
                       t.c_year = to_char(sysdate, 'yyyy') and
                       t.c_month = to_char(sysdate, 'mm') and
                       t.c_path_code like path_code || '%'and
                       t.c_number = '0'
                       group by t.c_org_level, t.c_level;
                end loop;
                close chang_level;
                commit;
END PRO_org_home_change_level;

   /**
  *组织与岗位管理 ->机构异动(历史)
  */
procedure PRO_org_count_change_his as

  Cursor temp_org is
    SELECT O.C_HID hid
      FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
     WHERE P.C_ORG_HID = O.C_HID
       AND O.C_STATUS = '1'
       AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
       AND P.C_STATUS = '1'
       AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
       and p.c_superior_hid <> p.c_org_hid
       and o.c_type = '0';
     Cursor temp_year is
     select to_char(add_months(sysdate, (level * -12)), 'yyyy')
       from dual
     connect by level < (to_char(sysdate, 'yyyy') - 2009);
  hid VARCHAR2(36);
  vyear varchar(10);
BEGIN
  open temp_year;
  loop
    fetch temp_year
      into vyear;
    exit when temp_year%notfound;

  DELETE FROM tb_org_count_change WHERE c_YEAR = vyear;
  open temp_org;
  loop
    fetch temp_org
      into hid;
    exit when temp_org%notfound;

  /*Init orgUnit Curr*/
    insert into tb_org_count_change value
    WITH all_org as
      (select ao.c_create_time,
              ao.c_updatetype,
              ao.c_workflow_status,
              ao1.c_superior_hid,
              ao1.C_PATH_CODE,
              ao.c_hid
         from TB_ORG_ORGUNIT ao, Tb_Org_Unitrelation ao1
        where TO_CHAR(ao.C_CREATE_TIME, 'yyyy') = vyear
          and ao.c_hid = ao1.c_org_hid
          and ao.c_type = '1'
          AND SYSDATE BETWEEN ao1.C_BEGIN_DATE AND ao1.C_END_DATE), temp_org1 as
      (SELECT distinct *
         FROM all_org t2
        where exists
        (SELECT t1.C_PATH_CODE
                 FROM all_org T1
                WHERE t1.c_superior_hid = hid
                  and INSTR(t2.C_PATH_CODE, t1.C_PATH_CODE) > 0))
      select hid,
             sysdate,
             vyear,
             C_month AS MONTH,
             '1',
             tt2.aa AS YUEXINJIANNEWCOUNT,
             tt2.cc YUEDELETECOUNT,
             tt2.bb YUECHANGECOUNT
        from (select level C_month from dual connect by level < 13) tt1,
             (select distinct to_number(TO_CHAR(C_CREATE_TIME, 'mm')) t2_month,
                     sum(CASE WHEN C_UPDATETYPE = '2' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) cc,
                     sum(CASE WHEN C_UPDATETYPE = '0' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) aa,
                     sum(CASE WHEN C_UPDATETYPE IN ('1', '3', '4', '5') AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) bb
                from temp_org1) tt2
       where tt1.C_month = tt2.t2_month(+);

  /*Init Orgunit All*/
     insert into tb_org_count_change value WITH all_org as(
      select ao.c_create_time,
             ao.c_updatetype,
             ao.c_workflow_status,
             ao1.c_superior_hid,
             ao1.C_PATH_CODE,
             ao.c_hid
        from TB_ORG_ORGUNIT ao, Tb_Org_Unitrelation ao1
       where TO_CHAR(ao.C_CREATE_TIME, 'yyyy') = vyear
         and ao.c_hid = ao1.c_org_hid
         AND SYSDATE BETWEEN ao1.C_BEGIN_DATE AND ao1.C_END_DATE
        ), temp_org1 as (
        SELECT distinct * FROM all_org t2 where INSTR(t2.C_PATH_CODE, hid) > 0)
        select hid,
         sysdate,
         vyear,
         C_month AS MONTH,
         '0',
         tt2.aa AS YUEXINJIANNEWCOUNT,
         tt2.cc YUEDELETECOUNT,
         tt2.bb YUECHANGECOUNT
          from (select level C_month from dual connect by level < 13) tt1,
         (select distinct to_number(TO_CHAR(C_CREATE_TIME, 'mm')) t2_month,
                          sum(CASE WHEN C_UPDATETYPE = '2' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) cc,
                          sum(CASE WHEN C_UPDATETYPE = '0' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) aa,
                          sum(CASE WHEN C_UPDATETYPE IN ('1', '3', '4', '5') AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) bb
            from temp_org1) tt2
         where tt1.C_month = tt2.t2_month(+);

  end loop;
  close temp_org;
  end loop;
  close temp_year;
  commit;
END PRO_org_count_change_his;

  /**
  *组织与岗位管理 ->机构异动
  */
procedure PRO_org_count_change as

  Cursor temp_org is
    SELECT O.C_HID hid
      FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
     WHERE P.C_ORG_HID = O.C_HID
       AND O.C_STATUS = '1'
       AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
       AND P.C_STATUS = '1'
       AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
       and p.c_superior_hid <> p.c_org_hid
       and o.c_type = '0';
   Cursor temp_month is
    select lpad(level, 2, '0') vmonth from dual connect by level < 13;
  hid VARCHAR2(36);
  vmonth varchar2(10);

BEGIN
  DELETE FROM tb_org_count_change WHERE c_YEAR = TO_CHAR(SYSDATE, 'yyyy');
  DELETE FROM Tb_Org_Count_Change_Detail WHERE c_YEAR = TO_CHAR(SYSDATE, 'yyyy');
  open temp_org;
  loop
    fetch temp_org
      into hid;
    exit when temp_org%notfound;

/*  Init orgUnit Change Curr*/
    insert into tb_org_count_change value
    WITH all_org as
      (select ao.c_create_time,
              ao.c_updatetype,
              ao.c_workflow_status,
              ao1.c_superior_hid,
              ao1.C_PATH_CODE,
              ao.c_hid
         from TB_ORG_ORGUNIT ao, Tb_Org_Unitrelation ao1
        where TO_CHAR(ao.C_CREATE_TIME, 'yyyy') = TO_CHAR(sysdate, 'yyyy')
          and ao.c_hid = ao1.c_org_hid
          and ao.c_type = '1'
          AND SYSDATE BETWEEN ao1.C_BEGIN_DATE AND ao1.C_END_DATE), temp_org1 as
      (SELECT distinct c_create_time,
              c_hid,
      c_updatetype,
      c_workflow_status
         FROM all_org t2
        where exists
        (SELECT t1.C_PATH_CODE
                 FROM all_org T1
                WHERE t1.c_superior_hid = hid
                  and INSTR(t2.C_PATH_CODE, t1.C_PATH_CODE) > 0))
      select hid,
             sysdate,
             TO_CHAR(sysdate, 'yyyy'),
             C_month AS MONTH,
             '1',
             tt2.aa AS YUEXINJIANNEWCOUNT,
             tt2.cc YUEDELETECOUNT,
             tt2.bb YUECHANGECOUNT
        from (select level C_month from dual connect by level < 13) tt1,
             (select distinct to_number(TO_CHAR(C_CREATE_TIME, 'mm')) t2_month,
                     sum(CASE WHEN C_UPDATETYPE = '2' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) cc,
                     sum(CASE WHEN C_UPDATETYPE = '0' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) aa,
                     sum(CASE WHEN C_UPDATETYPE IN ('1', '3', '4', '5') AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) bb
               from temp_org1) tt2
       where tt1.C_month = tt2.t2_month(+);

 /* Init orgUnit Change All*/
  insert into tb_org_count_change value
     WITH all_org as(
        select ao.c_create_time,
               ao.c_updatetype,
               ao.c_workflow_status,
               ao1.c_superior_hid,
               ao1.C_PATH_CODE,
               ao.c_hid
          from TB_ORG_ORGUNIT ao, Tb_Org_Unitrelation ao1
         where TO_CHAR(ao.C_CREATE_TIME, 'yyyy') = TO_CHAR(sysdate, 'yyyy')
           and ao.c_hid = ao1.c_org_hid
           AND SYSDATE BETWEEN ao1.C_BEGIN_DATE AND ao1.C_END_DATE
       ),temp_org1 as (
          SELECT distinct c_create_time,c_hid,
      c_updatetype,
      c_workflow_status  FROM all_org t2 where INSTR(t2.C_PATH_CODE,hid) > 0
       )
       select hid,
         sysdate,
         TO_CHAR(sysdate, 'yyyy'),
         C_month AS MONTH,
         '0',
         tt2.aa AS YUEXINJIANNEWCOUNT,
         tt2.cc YUEDELETECOUNT,
         tt2.bb YUECHANGECOUNT
       from (select level C_month from dual connect by level < 13) tt1,
             (select distinct to_number(TO_CHAR(C_CREATE_TIME, 'mm')) t2_month,
                     sum(CASE WHEN C_UPDATETYPE = '2' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) cc,
                     sum(CASE WHEN C_UPDATETYPE = '0' AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) aa,
                     sum(CASE WHEN C_UPDATETYPE IN ('1', '3', '4', '5') AND C_WORKFLOW_STATUS = '2' THEN 1 ELSE 0 END) over(partition by TO_CHAR(C_CREATE_TIME, 'mm')) bb
               from   temp_org1) tt2
         where tt1.C_month = tt2.t2_month(+);

  open temp_month;
  loop
    fetch temp_month
      into vmonth;
    exit when temp_month%notfound;

    /*Init orgUnit change detail curr*/
    insert into Tb_Org_Count_Change_Detail value
       WITH all_org as(
          select ao.c_create_time,
                 ao.c_updatetype,
                 ao.c_workflow_status,
                 ao.C_UNITCLASS,
                 ao1.c_superior_hid,
                 ao1.C_PATH_CODE,
                 ao.c_hid
                 from TB_ORG_ORGUNIT ao, Tb_Org_Unitrelation ao1
           where TO_CHAR(ao.C_CREATE_TIME, 'yyyy') = TO_CHAR(sysdate,'yyyy')
             and ao.c_hid = ao1.c_org_hid
             and ao.c_type = '1'
             AND SYSDATE BETWEEN ao1.C_BEGIN_DATE AND ao1.C_END_DATE
       ),temp_org1 as (
       SELECT distinct c_create_time,
                       c_updatetype,
                       c_workflow_status,
                       C_UNITCLASS,
                       c_hid
         FROM all_org t2
        where exists
        (SELECT t1.C_PATH_CODE
                 FROM all_org T1
                WHERE t1.c_superior_hid = hid
                  and INSTR(t2.C_PATH_CODE, t1.C_PATH_CODE) > 0)
       )
       select hid,sysdate,TO_CHAR(sysdate,'yyyy'),vmonth,'1','add',
         sum(DECODE(C_UNITCLASS, '1',1,0))  单位,
               sum(DECODE(C_UNITCLASS, '2',1,0))  部门,
               sum(DECODE(C_UNITCLASS, '3',1,0))  直属机构,
               sum(DECODE(C_UNITCLASS, '4',1,0))   挂靠机构,
               sum(DECODE(C_UNITCLASS, '5',1,0))   处室,
               sum(DECODE(C_UNITCLASS, '6',1,0))    科室 ,
               sum(DECODE(C_UNITCLASS, '7',1,0))   分部,
               sum(DECODE(C_UNITCLASS, '8',1,0))   班组,
               sum(CASE WHEN (C_UNITCLASS not in ('1','2','3','4','5','6','7','8') or C_UNITCLASS is null) THEN 1 ELSE 0 END )   其他内设
       FROM   temp_org1 WHERE to_char(C_CREATE_TIME, 'MM') =vmonth and C_UPDATETYPE ='0'  and  C_WORKFLOW_STATUS = '2'
       union all
       select hid,sysdate,TO_CHAR(sysdate,'yyyy'),vmonth,'1','delete',
               sum(DECODE(C_UNITCLASS, '1',1,0))  单位,
               sum(DECODE(C_UNITCLASS, '2',1,0))  部门,
               sum(DECODE(C_UNITCLASS, '3',1,0))  直属机构,
               sum(DECODE(C_UNITCLASS, '4',1,0))   挂靠机构,
               sum(DECODE(C_UNITCLASS, '5',1,0))   处室,
               sum(DECODE(C_UNITCLASS, '6',1,0))    科室 ,
               sum(DECODE(C_UNITCLASS, '7',1,0))   分部,
               sum(DECODE(C_UNITCLASS, '8',1,0))   班组,
               sum(CASE WHEN (C_UNITCLASS not in ('1','2','3','4','5','6','7','8') or C_UNITCLASS is null) THEN 1 ELSE 0 END )   其他内设
          FROM  temp_org1 WHERE to_char(C_CREATE_TIME, 'MM') =vmonth and C_UPDATETYPE ='2'  and  C_WORKFLOW_STATUS = '2'
       union all
       select hid,sysdate,TO_CHAR(sysdate,'yyyy'),vmonth,'1','update',
               sum(DECODE(C_UNITCLASS, '1',1,0))  单位,
               sum(DECODE(C_UNITCLASS, '2',1,0))  部门,
               sum(DECODE(C_UNITCLASS, '3',1,0))  直属机构,
               sum(DECODE(C_UNITCLASS, '4',1,0))   挂靠机构,
               sum(DECODE(C_UNITCLASS, '5',1,0))   处室,
               sum(DECODE(C_UNITCLASS, '6',1,0))    科室 ,
               sum(DECODE(C_UNITCLASS, '7',1,0))   分部,
               sum(DECODE(C_UNITCLASS, '8',1,0))   班组,
               sum(CASE WHEN (C_UNITCLASS not in ('1','2','3','4','5','6','7','8') or C_UNITCLASS is null) THEN 1 ELSE 0 END )   其他内设
       FROM  temp_org1 WHERE to_char(C_CREATE_TIME, 'MM') =vmonth and C_UPDATETYPE  in ('1', '3', '4', '5')  and  C_WORKFLOW_STATUS = '2';
     /*Init orgUnit change detail  all*/
     insert into Tb_Org_Count_Change_Detail value
        WITH all_org as(
          select ao.c_create_time,
          ao.c_updatetype,
          ao.C_UNITCLASS,
          ao.c_workflow_status,
          ao1.c_superior_hid,
          ao1.C_PATH_CODE
          from TB_ORG_ORGUNIT ao, Tb_Org_Unitrelation ao1
          where TO_CHAR(ao.C_CREATE_TIME, 'yyyy') = TO_CHAR(sysdate,'yyyy')
          and ao.c_hid = ao1.c_org_hid
          AND SYSDATE BETWEEN ao1.C_BEGIN_DATE AND ao1.C_END_DATE
       ),temp_org1 as (
          SELECT * FROM all_org t2 where INSTR(t2.C_PATH_CODE, hid) > 0
       )
        select hid,sysdate,TO_CHAR(sysdate,'yyyy'),vmonth,'0','add',
         sum(DECODE(C_UNITCLASS, '1',1,0))  单位,
               sum(DECODE(C_UNITCLASS, '2',1,0))  部门,
               sum(DECODE(C_UNITCLASS, '3',1,0))  直属机构,
               sum(DECODE(C_UNITCLASS, '4',1,0))   挂靠机构,
               sum(DECODE(C_UNITCLASS, '5',1,0))   处室,
               sum(DECODE(C_UNITCLASS, '6',1,0))    科室 ,
               sum(DECODE(C_UNITCLASS, '7',1,0))   分部,
               sum(DECODE(C_UNITCLASS, '8',1,0))   班组,
               sum(CASE WHEN (C_UNITCLASS not in ('1','2','3','4','5','6','7','8') or C_UNITCLASS is null) THEN 1 ELSE 0 END )   其他内设
       FROM   temp_org1 WHERE to_char(C_CREATE_TIME, 'MM') =vmonth and C_UPDATETYPE ='0'  and  C_WORKFLOW_STATUS = '2'
       union all
       select hid,sysdate,TO_CHAR(sysdate,'yyyy'),vmonth,'0','delete',
               sum(DECODE(C_UNITCLASS, '1',1,0))  单位,
               sum(DECODE(C_UNITCLASS, '2',1,0))  部门,
               sum(DECODE(C_UNITCLASS, '3',1,0))  直属机构,
               sum(DECODE(C_UNITCLASS, '4',1,0))   挂靠机构,
               sum(DECODE(C_UNITCLASS, '5',1,0))   处室,
               sum(DECODE(C_UNITCLASS, '6',1,0))    科室 ,
               sum(DECODE(C_UNITCLASS, '7',1,0))   分部,
               sum(DECODE(C_UNITCLASS, '8',1,0))   班组,
               sum(CASE WHEN (C_UNITCLASS not in ('1','2','3','4','5','6','7','8') or C_UNITCLASS is null) THEN 1 ELSE 0 END )   其他内设
          FROM  temp_org1 WHERE to_char(C_CREATE_TIME, 'MM') =vmonth and C_UPDATETYPE ='2'  and  C_WORKFLOW_STATUS = '2'
       union all
       select hid,sysdate,TO_CHAR(sysdate,'yyyy'),vmonth,'0','update',
               sum(DECODE(C_UNITCLASS, '1',1,0))  单位,
               sum(DECODE(C_UNITCLASS, '2',1,0))  部门,
               sum(DECODE(C_UNITCLASS, '3',1,0))  直属机构,
               sum(DECODE(C_UNITCLASS, '4',1,0))   挂靠机构,
               sum(DECODE(C_UNITCLASS, '5',1,0))   处室,
               sum(DECODE(C_UNITCLASS, '6',1,0))    科室 ,
               sum(DECODE(C_UNITCLASS, '7',1,0))   分部,
               sum(DECODE(C_UNITCLASS, '8',1,0))   班组,
               sum(CASE WHEN (C_UNITCLASS not in ('1','2','3','4','5','6','7','8') or C_UNITCLASS is null) THEN 1 ELSE 0 END )   其他内设
       FROM  temp_org1 WHERE to_char(C_CREATE_TIME, 'MM') =vmonth and C_UPDATETYPE  in ('1', '3', '4', '5')  and  C_WORKFLOW_STATUS = '2';
     end loop;
  close temp_month;
  end loop;
  close temp_org;
  commit;
END PRO_org_count_change;

/**
@ date 2015-12-31
@ 组织机构图中间表 tb_canvas
*/
procedure PRO_insert_canvas as
  begin
   delete from tb_canvas;
   insert into tb_canvas WITH temp_org AS(
SELECT
     O.C_HID,
     o.c_name,
     p.C_SUPERIOR_HID,
     o.c_unitclass,
     o.c_Type,
     o.c_storey,
     p.c_dim_hid,
     o.C_SHOW_ORDER,
     o.C_EST_DATE,
     o.C_CHARACTER_DEP,
     o.c_people_amount_cadres,
     p.c_path_code
FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
WHERE
     O.C_HID = P.C_ORG_HID AND O.C_STATUS = '1' AND P.C_STATUS = '1'
AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
and p.c_superior_hid <> p.c_org_hid
and o.c_type ='0'
)
SELECT  '-'  sizeType,
       o.c_superior_hid parentId,
       o.c_hid hId,
       o.c_name title,
       o.c_hid id,
       o.c_superior_hid superorHid,
       o.c_dim_hid dimensionId,
       nvl(o.c_people_amount_cadres, 0) peopleAmount,
       (select count(1 ) from tb_sta_emp_org org
       where
               sysdate between org.c_begin_date and org.c_end_date
            and  org.C_EMPLOYEE_STATUS = '2' and org.C_ACTIVE_STATUS IN ('2','10','24','25','36')
              and org.C_COMPANY_HID = o.c_hid  ) postPeople,
       o.c_unitclass,
       o.C_CHARACTER_DEP,
       o.C_SHOW_ORDER,
       o.c_type,
       o.c_storey
  FROM
 temp_org o;

insert into tb_canvas WITH TB_ORG AS
 (SELECT O.C_HID,
         o.c_name,
         p.C_SUPERIOR_HID,
         o.c_unitclass,
         o.c_Type,
         o.c_storey,
         p.c_dim_hid,
         o.C_SHOW_ORDER,
         o.C_EST_DATE,
         o.C_CHARACTER_DEP,
         o.C_PEOPLE_AMOUNT,
         p.c_path_code
    FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
   WHERE O.C_HID = P.C_ORG_HID
     AND O.C_STATUS = '1'
     AND P.C_STATUS = '1'
     AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
     AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
     and p.c_superior_hid <> p.c_org_hid
     and o.c_type = '1'
  )

SELECT   '|'  sizeType,
       o.c_superior_hid parentId,
       o.c_hid hId,
       o.c_name title,
       o.c_hid id,
       o.c_superior_hid superorHid,
       o.c_dim_hid dimensionId,
       nvl(o.C_PEOPLE_AMOUNT, 0) peopleAmount,
       (select count(1)
          from tb_sta_emp_org org
         where org.C_EMPLOYEE_STATUS = '2'
           and org.C_ACTIVE_STATUS IN ('2', '10', '24', '25', '36')
           and sysdate between org.c_begin_date and org.c_end_date
           and exists
         (select 1
                  from TB_ORG tb
                 where tb.c_hid=org.c_org_hid and tb.C_PATH_CODE like o.c_path_code || '%')) postPeople,
       o.c_unitclass,
       o.C_CHARACTER_DEP,
       o.C_SHOW_ORDER,
       o.c_type,
       o.c_storey
  FROM TB_ORG o ;
   commit;
end pro_insert_canvas;



/*岗位统计*/
PROCEDURE PRO_STA_COUNT_POS_CLASS IS
Cursor temp_org is
    SELECT O.C_HID hid,o.c_name vname
      FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
     WHERE P.C_ORG_HID = O.C_HID
       AND O.C_STATUS = '1'
       AND trunc(sysdate) BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
       AND P.C_STATUS = '1'
       AND trunc(sysdate) BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
       and p.c_superior_hid <> p.c_org_hid
       and o.c_type = '0'
       and o.c_storey in ('1','2','3','4');
  hid VARCHAR2(36);
  vname VARCHAR2(1000);
BEGIN
  DELETE TB_sta_count_pos_class ;
   open temp_org;
  loop
    fetch temp_org
      into hid,vname;
    exit when temp_org%notfound;
    /*Init JiaShiCang Count All*/
     insert into TB_sta_count_pos_class
WITH TB_ORG AS(
SELECT O.C_HID,p.c_path_code
  FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
 WHERE P.C_ORG_HID = O.C_HID
   AND O.C_STATUS = '1'
   AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
   AND P.C_STATUS = '1'
   AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
   and p.c_superior_hid <> p.c_org_hid
   and o.c_type ='0'
     ), temp_org as (
     SELECT t.c_hid
       FROM TB_ORG T
   where instr(t.c_path_code,hid)>0
     )
     SELECT /*distinct  hid,sysdate,'0',T3.C_EMPLOYEEFORMS,sum(case
                                 when topc.c_code_item like '%管理%' then
                                  1 else 0
                               end) over(partition by T3.C_EMPLOYEEFORMS) as 管理类 ,
            SUM(case
                                 when topc.c_code_item like '%技术%' then
                                  1 else 0
                               end) over(partition by T3.C_EMPLOYEEFORMS)  AS 专业技术类,
           sum(case
                                 when topc.c_code_item like '%技能%' then
                                 1 else 0
                               end) over(partition by T3.C_EMPLOYEEFORMS)  AS 技能类,
            sum(case
                                 when topc.c_code_item like '%辅助%' then
                                  1 else 0
                               end) over(partition by T3.C_EMPLOYEEFORMS)  AS 辅助类,
           sum(case
                                 WHEN topc.c_code_item IS NULL OR
                                      (topc.c_code_item NOT like '%管理%' AND
                                      topc.c_code_item NOT like '%技术%' AND
                                      topc.c_code_item NOT like '%技能%' AND
                                      topc.C_CODE_ITEM NOT like '%辅助%') THEN
                                 1 else 0
                               end) over(partition by T3.C_EMPLOYEEFORMS)  AS 其他*/
            hid,sysdate,'0',T3.C_EMPLOYEEFORMS,
            count(distinct(case WHEN topc.c_code_item like '%管理%' then  t2.c_oid else null end )) as 管理类,
            count(distinct(case WHEN topc.c_code_item like '%技术%' then  t2.c_oid else null end )) AS 专业技术类,
            count(distinct(case WHEN topc.c_code_item like '%技能%' then  t2.c_oid else null end )) AS 技能类,
            count(distinct(case WHEN topc.c_code_item like '%辅助%' then  t2.c_oid else null end )) AS 辅助类,
            count(distinct(case when topc.c_code_item IS NULL OR
                                      (topc.c_code_item NOT like '%管理%' AND
                                      topc.c_code_item NOT like '%技术%' AND
                                      topc.c_code_item NOT like '%技能%' AND
                                      topc.C_CODE_ITEM NOT like '%辅助%') then  t2.c_oid else null end )) AS 其他
      /* FROM temp_org             org,
            TB_STA_EMP_ORG       T1,
            TB_STA_EMP           T2,
            TB_STA_EMP_CLASS     T3,
            TB_ORG_POSITION      TOP,
            TB_ORG_POSITIONCLASS topc
      WHERE org.C_hid = t1.C_COMPANY_HID
        AND T2.C_OID = T3.C_EMPLOYEE_ID
        AND T1.C_EMPLOYEE_ID = T2.C_OID
        AND T1.C_POSITION_HID = TOP.C_HID
        and topc.c_oid = TOP.C_POST_CLASS_ID
        \*AND T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')*\
        --AND T3.C_EMPLOYEEFORMS IN (1,3,2,4)
        and t1.c_active_status in ('2','10','24','25','36')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND trunc(sysdate) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND trunc(sysdate) BETWEEN T3.C_BEGIN_DATE AND T3.C_END_DATE
        AND trunc(sysdate) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE ;*/
         FROM TB_STA_EMP           T2,
            temp_org             org,
            TB_STA_EMP_CLASS     T3,
            TB_STA_EMP_ORG       T1
            left join
            TB_ORG_POSITION      TOP
            on   t1.c_Position_Hid = TOP.C_HID
            AND trunc(sysdate) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
            left join TB_ORG_POSITIONCLASS topc
            on   TOP.C_POST_CLASS_ID = topc.c_oid

      WHERE
         T1.C_EMPLOYEE_ID = T2.C_OID
         AND org.C_hid = t1.C_COMPANY_HID
        and T2.C_OID = T3.C_EMPLOYEE_ID
        and t1.c_active_status in  ('2','10','24','25','36')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND trunc(sysdate) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND trunc(sysdate) BETWEEN T3.C_BEGIN_DATE AND T3.C_END_DATE
         group by t3.C_EMPLOYEEFORMS;
     end loop;
  close temp_org;
  COMMIT;
END PRO_STA_COUNT_POS_CLASS;

/* 业务人才首页中间表 */
--业务人才首页中间表
PROCEDURE pro_talents_totalData IS
Cursor temp_org is
    SELECT O.C_HID hid,o.c_name vname,p.c_path_code pathCode
      FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
     WHERE P.C_ORG_HID = O.C_HID
       AND O.C_STATUS = '1'
       AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
       AND P.C_STATUS = '1'
       AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
       and p.c_superior_hid <> p.c_org_hid
       and o.c_type = '0';
  hid VARCHAR2(36);
  vname VARCHAR2(1000);
  pathCode  VARCHAR2(2000);
BEGIN

  DELETE FROM TB_TALENTS_TOTALDATA ;
  DELETE FROM TB_TALENTS_EDUCATION_TOTAL;
  DELETE FROM TB_TALENTS_THREE_TEAM;

   open temp_org;
  loop
    fetch temp_org
      into hid,vname,pathCode;
    exit when temp_org%notfound;
    /*人才总数 中间表 (全部) */
    insert into TB_TALENTS_TOTALDATA(TALENTS_NUM,OTHER_TALENTS_NUM,ORG_LEVEL,ORG_HID)
    WITH TB_ORG AS(
   SELECT O.C_HID, p.c_path_code
     FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
    WHERE P.C_ORG_HID = O.C_HID
      AND O.C_STATUS = '1'
      AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
      AND P.C_STATUS = '1'
      AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
      and p.c_superior_hid <> p.c_org_hid
      AND o.c_type = '0'),
    temp_org1 as (
    SELECT t.c_hid
      FROM TB_ORG T
      where instr(t.c_path_code ,pathCode) > 0 )

 SELECT SUM(COUNT(DISTINCT(CASE
                             WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                              T2.C_OID
                           END))), --AS 人才数,
        SUM(COUNT(DISTINCT(CASE
                             WHEN  T3.c_techniclevel not IN ('1', '2', '3', '4', '5')  or
                                      t3.c_techniclevel is null THEN
                              T2.C_OID
                             ELSE
                              NULL
                           END))), --AS 其他人才数
        0,--机构类别
        hid
   FROM temp_org1         org inner join
        TB_STA_EMP_ORG   T1 on org.c_hid=t1.C_COMPANY_HID inner join
        TB_STA_EMP       T2 on T1.C_EMPLOYEE_ID = T2.C_OID
      left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1

  WHERE    T1.C_ACTIVE_STATUS NOT IN
        ('21', '22', '34', '37', '23', '30', '31')
    AND T1.C_EMPLOYEE_STATUS = '2'
    AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
  GROUP BY org.c_hid;
   /*人才总数 中间表 (本部) */
    insert into TB_TALENTS_TOTALDATA(TALENTS_NUM,OTHER_TALENTS_NUM,ORG_LEVEL,ORG_HID)


 SELECT  COUNT(DISTINCT(CASE
                             WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                              T2.C_OID
                           END)) , --AS 人才数,
         COUNT(DISTINCT(CASE
                             WHEN  T3.c_techniclevel not IN ('1', '2', '3', '4', '5')  or
                                      t3.c_techniclevel is null THEN
                              T2.C_OID
                             ELSE
                              NULL
                           END)) , --AS 其他人才数
        1,--机构类别
        hid
   FROM   TB_STA_EMP_ORG   T1   inner join
        TB_STA_EMP       T2 on T1.C_EMPLOYEE_ID = T2.C_OID
      left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1

  WHERE    T1.C_ACTIVE_STATUS NOT IN
        ('21', '22', '34', '37', '23', '30', '31')
    AND T1.C_EMPLOYEE_STATUS = '2'
    and t1.c_company_hid=hid
    AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE  ;


  /*三支人才队伍分析 中间表 */

     --管理（全部）
     insert into TB_TALENTS_THREE_TEAM(RENCAINMB,RENYUANTOTAL,ORG_LEVEL,ORG_HID,POST_TYPE)
     WITH TB_ORG AS( SELECT O.C_HID,O.C_TYPE,P.C_PATH_CODE
     FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P WHERE P.C_ORG_HID = O.C_HID
     AND p.c_superior_hid <> p.c_org_hid AND O.C_STATUS = '1'
     AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE AND P.C_STATUS = '1'
     AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE  and  o.c_type ='0'),

     temp_org1 as (SELECT t.c_hid FROM TB_ORG T  where instr(T.C_PATH_CODE ,pathCode)>0)

     SELECT

            SUM(COUNT(DISTINCT(CASE
                                 WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                                  T2.C_OID
                               END))),
            SUM(COUNT(DISTINCT(t2.C_OID   ))),
            0,hid,'管理'
       FROM temp_org1             org inner join
            TB_STA_EMP_ORG       T1 on org.C_hid = t1.C_COMPANY_HID inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      WHERE
     T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND TOP.C_STATUS = '1'
        AND TRUNC(SYSDATE) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
      and topc.c_code_item like '%管理%'
      GROUP BY org.c_hid;

       --管理（本部）
     insert into TB_TALENTS_THREE_TEAM(RENCAINMB,RENYUANTOTAL,ORG_LEVEL,ORG_HID,POST_TYPE)

     SELECT

             COUNT(DISTINCT(CASE
                                 WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                                  T2.C_OID
                               END)) ,
            COUNT(DISTINCT(t2.C_OID )),
            1,hid,'管理'
       FROM   TB_STA_EMP_ORG       T1 inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      WHERE t1.c_company_hid=hid and
     T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND TOP.C_STATUS = '1'
        AND TRUNC(SYSDATE) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
      and topc.c_code_item like '%管理%'  ;

   --技术（全部）
     insert into TB_TALENTS_THREE_TEAM(RENCAINMB,RENYUANTOTAL,ORG_LEVEL,ORG_HID,POST_TYPE)
     WITH TB_ORG AS( SELECT O.C_HID,O.C_TYPE,P.C_PATH_CODE
     FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P WHERE P.C_ORG_HID = O.C_HID
     AND p.c_superior_hid <> p.c_org_hid AND O.C_STATUS = '1'
     AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE AND P.C_STATUS = '1'
     AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE  and  o.c_type ='0'),

     temp_org1 as (SELECT t.c_hid FROM TB_ORG T  where instr(T.C_PATH_CODE ,pathCode)>0)

     SELECT

            SUM(COUNT(DISTINCT(CASE
                                 WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                                  T2.C_OID
                               END))),
            SUM(COUNT(DISTINCT(t2.C_OID   ))),
            0,hid,'技术'
       FROM temp_org1             org inner join
            TB_STA_EMP_ORG       T1 on org.C_hid = t1.C_COMPANY_HID inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      WHERE
     T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND TOP.C_STATUS = '1'
        AND TRUNC(SYSDATE) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
      and topc.c_code_item like '%技术%'
      GROUP BY org.c_hid;

       --技术（本部）
     insert into TB_TALENTS_THREE_TEAM(RENCAINMB,RENYUANTOTAL,ORG_LEVEL,ORG_HID,POST_TYPE)

     SELECT

             COUNT(DISTINCT(CASE
                                 WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                                  T2.C_OID
                               END)) ,
            COUNT(DISTINCT(t2.C_OID  )),
            1,hid,'技术'
       FROM   TB_STA_EMP_ORG       T1 inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      WHERE   t1.c_company_hid=hid and
     T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND TOP.C_STATUS = '1'
        AND TRUNC(SYSDATE) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
      and topc.c_code_item like '%技术%'  ;


   --技术（全部）
     insert into TB_TALENTS_THREE_TEAM(RENCAINMB,RENYUANTOTAL,ORG_LEVEL,ORG_HID,POST_TYPE)
     WITH TB_ORG AS( SELECT O.C_HID,O.C_TYPE,P.C_PATH_CODE
     FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P WHERE P.C_ORG_HID = O.C_HID
     AND p.c_superior_hid <> p.c_org_hid AND O.C_STATUS = '1'
     AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE AND P.C_STATUS = '1'
     AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE  and  o.c_type ='0'),

     temp_org1 as (SELECT t.c_hid FROM TB_ORG T  where instr(T.C_PATH_CODE ,pathCode)>0)

     SELECT

            SUM(COUNT(DISTINCT(CASE
                                 WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                                  T2.C_OID
                               END))),
            SUM(COUNT(DISTINCT(t2.C_OID   ))),
            0,hid,'技能'
       FROM temp_org1             org inner join
            TB_STA_EMP_ORG       T1 on org.C_hid = t1.C_COMPANY_HID inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      WHERE
     T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND TOP.C_STATUS = '1'
        AND TRUNC(SYSDATE) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
      and topc.c_code_item like '%技能%'
      GROUP BY org.c_hid;

       --技术（本部）
     insert into TB_TALENTS_THREE_TEAM(RENCAINMB,RENYUANTOTAL,ORG_LEVEL,ORG_HID,POST_TYPE)

     SELECT

             COUNT(DISTINCT(CASE
                                 WHEN T3.c_techniclevel IN ('1', '2', '3', '4')  THEN
                                  T2.C_OID
                               END)) ,
           COUNT(DISTINCT(t2.C_OID   )),
            1,hid,'技能'
       FROM   TB_STA_EMP_ORG       T1 inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      WHERE   t1.c_company_hid=hid and
     T1.C_ACTIVE_STATUS NOT IN
            ('21', '22', '34', '37', '23', '30', '31')
        AND T1.C_EMPLOYEE_STATUS = '2'
        AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
        AND TOP.C_STATUS = '1'
        AND TRUNC(SYSDATE) BETWEEN TOP.C_BEGIN_DATE AND TOP.C_END_DATE
      and topc.c_code_item like '%技能%'  ;


/*人才学历分布统计*/

insert into TB_TALENTS_EDUCATION_TOTAL(BOSHI,SHUOSHI,BENKE,DAZHUAN,GAOZHONG
,ZHONGZHUAN,CHUZHONG,KONG,ORG_HID,ORG_LEVEL,POST_TYPE)
WITH TB_ORG AS(
 SELECT O.C_HID, O.C_TYPE, P.C_PATH_CODE
   FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
  WHERE P.C_ORG_HID = O.C_HID
    AND p.c_superior_hid <> p.c_org_hid
    AND O.C_STATUS = '1'
    AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
    AND P.C_STATUS = '1'
    AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
    and o.c_type = '0'),
 temp_org as(
SELECT t.c_hid
  FROM TB_ORG T
 where instr(T.C_PATH_CODE, pathCode) > 0  )

  SELECT SUM(COUNT(DISTINCT(CASE
                              WHEN  T3.c_techniclevel IN ('1', '2', '3', '4')  AND
                                   t4.C_EDUCATIONLEVEL in ('1', '2') THEN
                               T2.C_OID
                            END)))  ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL in ('3', '4', '5') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('20', '21', '22') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('23', '24', '25') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('32', '33') THEN
                               T2.C_OID
                            END)))  ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('30', '31') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('40', '41') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND ( t4.C_EDUCATIONLEVEL  NOT IN
                                   ('40', '41', '33', '32', '30', '31', '23', '24', '25', '20', '21', '22', '3', '4', '5', '1', '2') OR
                                    t4.C_EDUCATIONLEVEL  IS NULL) THEN
                               T2.C_OID
                            END))) ,hid,0,'管理'
    FROM   temp_org             org inner join
            TB_STA_EMP_ORG       T1 on org.C_hid = t1.C_COMPANY_HID inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      left join tb_v_noweducationexperience t4 on t4.c_employee_id=t2.c_oid
   WHERE
       T1.C_ACTIVE_STATUS NOT IN
         ('21', '22', '34', '37', '23', '30', '31')
     AND T1.C_EMPLOYEE_STATUS = '2'
     AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
     and topc.c_code_item like '%管理%'
   GROUP BY org.c_hid;

insert into TB_TALENTS_EDUCATION_TOTAL(BOSHI,SHUOSHI,BENKE,DAZHUAN,GAOZHONG
,ZHONGZHUAN,CHUZHONG,KONG,ORG_HID,ORG_LEVEL,POST_TYPE)
WITH TB_ORG AS(
 SELECT O.C_HID, O.C_TYPE, P.C_PATH_CODE
   FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
  WHERE P.C_ORG_HID = O.C_HID
    AND p.c_superior_hid <> p.c_org_hid
    AND O.C_STATUS = '1'
    AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
    AND P.C_STATUS = '1'
    AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
    and o.c_type = '0'),
 temp_org as(
SELECT t.c_hid
  FROM TB_ORG T
 where instr(T.C_PATH_CODE, pathCode) > 0  )

  SELECT SUM(COUNT(DISTINCT(CASE
                              WHEN  T3.c_techniclevel IN ('1', '2', '3', '4')  AND
                                   t4.C_EDUCATIONLEVEL in ('1', '2') THEN
                               T2.C_OID
                            END)))  ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL in ('3', '4', '5') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('20', '21', '22') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('23', '24', '25') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('32', '33') THEN
                               T2.C_OID
                            END)))  ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('30', '31') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('40', '41') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND ( t4.C_EDUCATIONLEVEL  NOT IN
                                   ('40', '41', '33', '32', '30', '31', '23', '24', '25', '20', '21', '22', '3', '4', '5', '1', '2') OR
                                    t4.C_EDUCATIONLEVEL  IS NULL) THEN
                               T2.C_OID
                            END))) ,hid,0,'技术'
    FROM   temp_org             org inner join
            TB_STA_EMP_ORG       T1 on org.C_hid = t1.C_COMPANY_HID inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      left join tb_v_noweducationexperience t4 on t4.c_employee_id=t2.c_oid
   WHERE
       T1.C_ACTIVE_STATUS NOT IN
         ('21', '22', '34', '37', '23', '30', '31')
     AND T1.C_EMPLOYEE_STATUS = '2'
     AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
     and topc.c_code_item like '%技术%'
   GROUP BY org.c_hid;

insert into TB_TALENTS_EDUCATION_TOTAL(BOSHI,SHUOSHI,BENKE,DAZHUAN,GAOZHONG
,ZHONGZHUAN,CHUZHONG,KONG,ORG_HID,ORG_LEVEL,POST_TYPE)
WITH TB_ORG AS(
 SELECT O.C_HID, O.C_TYPE, P.C_PATH_CODE
   FROM TB_ORG_ORGUNIT O, TB_ORG_UNITRELATION P
  WHERE P.C_ORG_HID = O.C_HID
    AND p.c_superior_hid <> p.c_org_hid
    AND O.C_STATUS = '1'
    AND SYSDATE BETWEEN O.C_BEGIN_DATE AND O.C_END_DATE
    AND P.C_STATUS = '1'
    AND SYSDATE BETWEEN P.C_BEGIN_DATE AND P.C_END_DATE
    and o.c_type = '0'),
 temp_org as(
SELECT t.c_hid
  FROM TB_ORG T
 where instr(T.C_PATH_CODE, pathCode) > 0  )

  SELECT SUM(COUNT(DISTINCT(CASE
                              WHEN  T3.c_techniclevel IN ('1', '2', '3', '4')  AND
                                   t4.C_EDUCATIONLEVEL in ('1', '2') THEN
                               T2.C_OID
                            END)))  ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL in ('3', '4', '5') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('20', '21', '22') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('23', '24', '25') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('32', '33') THEN
                               T2.C_OID
                            END)))  ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('30', '31') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('40', '41') THEN
                               T2.C_OID
                            END))) ,
         SUM(COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND ( t4.C_EDUCATIONLEVEL  NOT IN
                                   ('40', '41', '33', '32', '30', '31', '23', '24', '25', '20', '21', '22', '3', '4', '5', '1', '2') OR
                                    t4.C_EDUCATIONLEVEL  IS NULL) THEN
                               T2.C_OID
                            END))) ,hid,0,'技能'
    FROM   temp_org             org inner join
            TB_STA_EMP_ORG       T1 on org.C_hid = t1.C_COMPANY_HID inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      left join tb_v_noweducationexperience t4 on t4.c_employee_id=t2.c_oid
   WHERE
       T1.C_ACTIVE_STATUS NOT IN
         ('21', '22', '34', '37', '23', '30', '31')
     AND T1.C_EMPLOYEE_STATUS = '2'
     AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
     and topc.c_code_item like '%技能%'
   GROUP BY org.c_hid;

insert into TB_TALENTS_EDUCATION_TOTAL(BOSHI,SHUOSHI,BENKE,DAZHUAN,GAOZHONG
,ZHONGZHUAN,CHUZHONG,KONG,ORG_HID,ORG_LEVEL,POST_TYPE)


  SELECT COUNT(DISTINCT(CASE
                              WHEN  T3.c_techniclevel IN ('1', '2', '3', '4')  AND
                                   t4.C_EDUCATIONLEVEL in ('1', '2') THEN
                               T2.C_OID
                            END))  ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL in ('3', '4', '5') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('20', '21', '22') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('23', '24', '25') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('32', '33') THEN
                               T2.C_OID
                            END))  ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('30', '31') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('40', '41') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND ( t4.C_EDUCATIONLEVEL  NOT IN
                                   ('40', '41', '33', '32', '30', '31', '23', '24', '25', '20', '21', '22', '3', '4', '5', '1', '2') OR
                                    t4.C_EDUCATIONLEVEL  IS NULL) THEN
                               T2.C_OID
                            END)) ,hid,1,'管理'
    FROM
            TB_STA_EMP_ORG       T1  inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      left join tb_v_noweducationexperience t4 on t4.c_employee_id=t2.c_oid
   WHERE T1.C_COMPANY_HID=hid and
       T1.C_ACTIVE_STATUS NOT IN
         ('21', '22', '34', '37', '23', '30', '31')
     AND T1.C_EMPLOYEE_STATUS = '2'
     AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
     and topc.c_code_item like '%管理%' ;

insert into TB_TALENTS_EDUCATION_TOTAL(BOSHI,SHUOSHI,BENKE,DAZHUAN,GAOZHONG
,ZHONGZHUAN,CHUZHONG,KONG,ORG_HID,ORG_LEVEL,POST_TYPE)


  SELECT COUNT(DISTINCT(CASE
                              WHEN  T3.c_techniclevel IN ('1', '2', '3', '4')  AND
                                   t4.C_EDUCATIONLEVEL in ('1', '2') THEN
                               T2.C_OID
                            END))  ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL in ('3', '4', '5') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('20', '21', '22') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('23', '24', '25') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('32', '33') THEN
                               T2.C_OID
                            END))  ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('30', '31') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('40', '41') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND ( t4.C_EDUCATIONLEVEL  NOT IN
                                   ('40', '41', '33', '32', '30', '31', '23', '24', '25', '20', '21', '22', '3', '4', '5', '1', '2') OR
                                    t4.C_EDUCATIONLEVEL  IS NULL) THEN
                               T2.C_OID
                            END)) ,hid,1,'技术'
    FROM
            TB_STA_EMP_ORG       T1 inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      left join tb_v_noweducationexperience t4 on t4.c_employee_id=t2.c_oid
   WHERE t1.c_company_hid=hid and
       T1.C_ACTIVE_STATUS NOT IN
         ('21', '22', '34', '37', '23', '30', '31')
     AND T1.C_EMPLOYEE_STATUS = '2'
     AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
     and topc.c_code_item like '%技术%' ;

insert into TB_TALENTS_EDUCATION_TOTAL(BOSHI,SHUOSHI,BENKE,DAZHUAN,GAOZHONG
,ZHONGZHUAN,CHUZHONG,KONG,ORG_HID,ORG_LEVEL,POST_TYPE)

  SELECT COUNT(DISTINCT(CASE
                              WHEN  T3.c_techniclevel IN ('1', '2', '3', '4')  AND
                                   t4.C_EDUCATIONLEVEL in ('1', '2') THEN
                               T2.C_OID
                            END))  ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL in ('3', '4', '5') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('20', '21', '22') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('23', '24', '25') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('32', '33') THEN
                               T2.C_OID
                            END))  ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                   t4.C_EDUCATIONLEVEL  in ('30', '31') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND
                                    t4.C_EDUCATIONLEVEL  in ('40', '41') THEN
                               T2.C_OID
                            END)) ,
         COUNT(DISTINCT(CASE
                              WHEN T3.c_techniclevel IN ('1', '2', '3', '4') AND ( t4.C_EDUCATIONLEVEL  NOT IN
                                   ('40', '41', '33', '32', '30', '31', '23', '24', '25', '20', '21', '22', '3', '4', '5', '1', '2') OR
                                    t4.C_EDUCATIONLEVEL  IS NULL) THEN
                               T2.C_OID
                            END)) ,hid,1,'技能'
    FROM
            TB_STA_EMP_ORG       T1  inner join
            TB_STA_EMP           T2 on  T2.C_OID = T1.C_EMPLOYEE_ID   inner join
            TB_ORG_POSITION      TOP on    T1.C_POSITION_HID = TOP.C_HID  inner join
            TB_ORG_POSITIONCLASS topc on   topc.c_oid = TOP.C_POST_CLASS_ID
            left join ( select tt.c_nameid C_EMPLOYEE_ID, tt.c_techniclevel,
      rank() over(partition by tt.c_nameid order by tt.C_TITLETIME desc, tt.c_techniclevel) rowSort
      from TB_MARJOR_SKILL_ASSESS tt  ) t3 on T2.C_OID = T3.C_EMPLOYEE_ID  and t3.rowSort=1
      left join tb_v_noweducationexperience t4 on t4.c_employee_id=t2.c_oid
   WHERE t1.c_company_hid=hid and
       T1.C_ACTIVE_STATUS NOT IN
         ('21', '22', '34', '37', '23', '30', '31')
     AND T1.C_EMPLOYEE_STATUS = '2'
     AND TRUNC(SYSDATE) BETWEEN T1.C_BEGIN_DATE AND T1.C_END_DATE
     and topc.c_code_item like '%技能%' ;
     end loop;
  close temp_org;
  COMMIT;
END pro_talents_totalData;

  procedure P_INIT_IN_ZUZHIGANGWEI_SCRIPT as
  begin
    /**
    @author xumingjian
    @date 2015-03-3
    @desc 组织岗位-->组织岗位那个长表
   */
  PRO_ZUZHIGANGWEICOUNT;

    /**
  *组织与岗位管理 ->机构异动
  */
  PRO_org_count_change;

   /**
   *@组织机构图中间表 tb_canvas
   */
   pro_insert_canvas;

   PRO_STA_COUNT_POS_CLASS;

   pro_talents_totalData;

  -- PRO_org_home_change_level;

  end P_INIT_IN_ZUZHIGANGWEI_SCRIPT;

END P_INIT_ZUZHIGANGWEI_SCRIPT;

```


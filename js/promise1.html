<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>

</head>

<body>
    <script>
        function timeOut(delay = 100) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(
                        "第一次"
                    ); //A:这个地方是一个传出函数,理解下:传出函数一般是先出现在参数,然后再出现在函数体,出现在函数体是以触发调用形式. 实际要执行什么函数是在调用的时候落实.
                    //其实也好理解 ,将传出函数理解为参数函数,参数函数=形参.在定义函数的时候只占位,实际参数在使用的时候赋值.
                    //resolve的形参，就是than函数的实参
                }, delay)
            })
        }

        function id1() {
            let p = timeOut(5000)
            p.then((data) => { //then(传入函数),理解下:这里的传入函数.实际就是一个函数的定义.这里使用了箭头函数.(参数)=>{函数体}
                console.log(data);
                return "123"; //如果不返回 promise 对象,则这里不会向下个then传值.
            }).then(() => {
                console.log('第二次');
            })
        }

        function id2() {
            let p = timeOut(3000) // 一般使用毫秒
            function abc(data) {
                console.log(data)
            }
            p.then(abc)
        }

        function id3() {
            let p = timeOut(3000) // 一般使用毫秒

            p.then((data) => {
                console.log(data);
                return new Promise((resolve, reject) => {
                    resolve("这个是第一个then 传出去的")
                }).then((data) => {
                    console.log(data)
                })
            })
        }

        function id4() {
            async function bb() {
                return "1234"
            }
            console.log(bb())
        }
        async function bb1(name) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(
                        name + ":3秒"
                    );
                }, 3000)
            })

        }

        async function bb2(name) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(
                        name + ":3秒"
                    );
                }, 3000)
            })

        }
        async function id5() {

            let p1 = await bb1("bb1")
            let p2 = await bb2("bb2")
            console.log(p1)
            console.log(p2)
        }


        async function doit() {
            var list = [];


            list.push(sayHello('a1'))
            list.push(sayHello('a2'));

            var result = await Promise.all(list);
            console.log(result);
            console.log('over')
        }

        async function sayHello(name) {
            await new Promise(function (resolve) {
                setTimeout(function () {
                    console.log(name + new Date());
                    resolve(name);
                }, 3000)
            })
        }

        async function id6() {
            var list = [];
            list.push(bb1("id6,bb1"));
            list.push(bb2("id6,bb2"))
            var result = await Promise.all(list);

            // console.log(result);
            // var x;
            // for (x in result) {
            //     console.log(result[x])
            // }
            $.each(result, function (key, val) {
                console.info(key); //将输出one two three
                console.info(val); //将输出1，2，3 这个val等同于obj[key]
            });

        }
    </script>

</body>
<button onclick="id1()">id1第一个promise例子</button>
<!-- 这个地方的注释 call 函数() -->
<div>这里只会输出,两个结果,分别是"第一次"与"第二次"</div>
<button onclick="id2()">id2第二个promise例子</button>
<div>这个地方将p.then(对应resolve函数,可以另外地方写这个函数的定义,注意这里是函数形参,不用执行())</div>
<button onclick="id3()">id3第三个promise例子</button>
<div>输出:第一次,以及"这个是第一个then 传出去的",通过then 返回 一个 promise对象</div>
<button onclick="id4()">id4测试下异步1</button>
<div>在一个函数的前面加 async 返回一个 promise 对象 其中 return "1234"
    等同 new promise ((resolve)=>{resolve("1234")})
</div>
<button onclick="id5()">id5测试下异步2</button>
<div>
    <li>强调下await 只能在 async里面</li>
    <li>await 可以直接取到resolve里的形参==then</li>
    <li>多个await只会按顺序执行,而不是并行</li>
</div>

<button onclick="doit()">doit异步并发demo</button>
<div>这个是网上的例子</div>
<button onclick="id6()">id6异步并发id5()</button>
<div>参数网上的例子,改进[测试下异步2]</div>

</html>